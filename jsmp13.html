<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JS MiniProject Day 13</title>
    <link rel="stylesheet" href="jsmp13.css" />
  </head>
  <body>
    <h1>Mini Project 1 : E-Commerce Product Catalog</h1>
    <div class="container">
      <h1>Product Catalog</h1>

      <div class="controls">
        <button onclick="filterByPrice(500)">Show Under $500</button>
        <button onclick="sortProducts('low')">Price: Low to High</button>
        <button onclick="displayProducts(allProducts)">Reset</button>
      </div>

      <div id="catalog" class="catalog-grid"></div>
    </div>

    <!-- Simple Modal for Details -->
    <div id="modal" class="modal" onclick="closeModal()">
      <div class="modal-content" onclick="event.stopPropagation()">
        <h2 id="modal-name"></h2>
        <p id="modal-desc"></p>
        <p id="modal-price"></p>
        <button onclick="closeModal()">Close</button>
      </div>
    </div>
    <hr />
    <h1>Mini Project : 2 Movie Search App (Fetch API + Async/Await)</h1>

    <!-- Required UI Elements (Missing from your snippet, added here) -->
    <div class="container">
      <div class="search-container">
        <input
          type="text"
          id="movie-title-input"
          placeholder="Enter movie
        title"
          value="Game"
        />
        <button onclick="searchMovie()">Search</button>
      </div>
      <!-- Container where movie cards will be displayed -->
      <div id="movie-results"></div>
    </div>

    <!-- Modal Structure -->
    <div id="modal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h2 id="modal-title"></h2>
        <p id="modal-year"></p>
        <p id="modal-runtime"></p>
        <p id="modal-plot"></p>
      </div>
    </div>

    <script>
      // !! IMPORTANT: Replace with your actual OMDb API Key !!
      const API_KEY = "YOUR_API_KEY";
      const resultsContainer = document.getElementById("movie-results");
      const modal = document.getElementById("modal");

      /**
       * Main function to handle the movie search triggered by the button click
       */
      async function searchMovie() {
        const titleInput = document.getElementById("movie-title-input");
        const title = titleInput.value.trim();

        if (title === "") {
          resultsContainer.innerHTML = "<p>Please enter a movie title.</p>";
          return;
        }

        resultsContainer.innerHTML = "<p>Searching...</p>";

        try {
          const url = `www.omdbapi.com{API_KEY}&s=${encodeURIComponent(title)}`;
          const response = await fetch(url);
          const data = await response.json();

          if (data.Response === "True") {
            displayMovies(data.Search);
          } else {
            resultsContainer.innerHTML = `<p>Error: ${data.Error}. Please try again.</p>`;
          }
        } catch (error) {
          resultsContainer.innerHTML =
            "<p>An error occurred while fetching data. Check your network or API key.</p>";
        }
      }

      function displayMovies(movies) {
        resultsContainer.innerHTML = "";

        movies.forEach((movie) => {
          const movieCard = document.createElement("div");
          movieCard.className = "movie-card";
          movieCard.onclick = () => fetchMovieDetails(movie.imdbID);

          const posterUrl =
            movie.Poster !== "N/A" ? movie.Poster : "via.placeholder.com";

          movieCard.innerHTML = `
            <img src="${posterUrl}" alt="${movie.Title} poster">
            <div class="movie-info">
                <h3>${movie.Title}</h3>
                <p>Year: ${movie.Year}</p>
            </div>
        `;
          resultsContainer.appendChild(movieCard);
        });
      }

      async function fetchMovieDetails(imdbID) {
        try {
          const url = `www.omdbapi.com{API_KEY}&i=${imdbID}&plot=full`;
          const response = await fetch(url);
          const data = await response.json();

          if (data.Response === "True") {
            displayDetailsModal(data);
          } else {
            alert("Could not fetch detailed information.");
          }
        } catch (error) {
          console.error("Detail fetch error:", error);
        }
      }
      function displayDetailsModal(movie) {
        document.getElementById("modal-title").innerText = movie.Title;
        document.getElementById("modal-year").innerText = `Year: ${movie.Year}`;
        document.getElementById("modal-plot").innerText = movie.Plot;
        document.getElementById(
          "modal-runtime"
        ).innerText = `Runtime: ${movie.Runtime}`;

        modal.style.display = "block";
      }

      function closeModal() {
        modal.style.display = "none";
      }
    </script>
    <hr />
    <h1>MiniProject No 3: Weather App</h1>

    <script src="jsmp13.js"></script>
    <div class="container3">
      <div class="weather-card">
        <h3>Weather App</h3>
        <input type="text" id="city-input" placeholder="Enter city name" />
        <button id="city-input-btn">Get Weather</button>
        <div id="weather-info" class="animate__animated animate__fadeIn">
          <h3 id="city-name"></h3>
          <p id="date"></p>
          <p id="temperature"></p>
          <p id="description"></p>
          <p id="wind-speed"></p>
        </div>
      </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://momentjs.com/downloads/moment.min.js"></script>
    <script>
      const url = "https://api.openweathermap.org/data/2.5/weather";
      const apiKey = "f00c38e0279b7bc85480c3fe775d518c";

      $(document).ready(function () {
        weatherFn("Pune");
      });

      async function weatherFn(cName) {
        const temp = `${url}?q=${cName}&appid=${apiKey}&units=metric`;
        try {
          const res = await fetch(temp);
          const data = await res.json();
          if (res.ok) {
            weatherShowFn(data);
          } else {
            alert("City not found. Please try again.");
          }
        } catch (error) {
          console.error("Error fetching weather data:", error);
        }
      }

      function weatherShowFn(data) {
        $("#city-name").text(data.name);
        $("#date").text(moment().format("MMMM Do YYYY, h:mm:ss a"));
        $("#temperature").html(`${data.main.temp}¬∞C`);
        $("#description").text(data.weather[0].description);
        $("#wind-speed").html(`Wind Speed: ${data.wind.speed} m/s`);
        $("#weather-info").fadeIn();
      }
    </script>
    <script>
      $("#city-input-btn").on("click", function () {
        let cityName = $("#city-input").val();
        weatherFn(cityName);
      });
    </script>
    <hr />
    <h1>Mini project 4: Employee Management System</h1>

    <div id="add-form">
      <input type="text" id="name" placeholder="Full Name" />
      <input type="text" id="position" placeholder="Position" />
      <button onclick="addEmployee()">Add Employee</button>
    </div>

    <ul id="employeeList"></ul>

    <script>
      const JSON_FILE_URL = "employees.json";

      // Requirement 1: Fetch and display
      async function initApp() {
        // Check if data already exists in localStorage; if not, fetch from JSON file
        if (!localStorage.getItem("employees")) {
          try {
            const response = await fetch(JSON_FILE_URL);
            const data = await response.json();
            localStorage.setItem("employees", JSON.stringify(data));
          } catch (error) {
            console.error("Error fetching initial JSON:", error);
            localStorage.setItem("employees", JSON.stringify([]));
          }
        }
        displayEmployees();
      }

      function displayEmployees() {
        const employees = JSON.parse(localStorage.getItem("employees")) || [];
        const list = document.getElementById("employeeList");

        list.innerHTML = employees
          .map(
            (emp) => `
        <li style="margin-bottom: 10px;">
            <strong>${emp.name}</strong> - ${emp.position} 
            <button onclick="deleteEmployee(${emp.id})">Delete</button>
        </li>
    `
          )
          .join("");
      }

      // Requirement 2: Add a new employee
      function addEmployee() {
        const name = document.getElementById("name").value;
        const position = document.getElementById("position").value;

        if (!name || !position) return alert("Please fill all fields");

        const employees = JSON.parse(localStorage.getItem("employees"));
        const newEmployee = {
          id: Date.now(), // Generate unique ID
          name: name,
          position: position,
        };

        employees.push(newEmployee);
        localStorage.setItem("employees", JSON.stringify(employees));

        // Clear inputs and refresh list
        document.getElementById("name").value = "";
        document.getElementById("position").value = "";
        displayEmployees();
      }

      // Requirement 3: Delete an employee
      function deleteEmployee(id) {
        let employees = JSON.parse(localStorage.getItem("employees"));
        employees = employees.filter((emp) => emp.id !== id);

        localStorage.setItem("employees", JSON.stringify(employees));
        displayEmployees();
      }

      // Start the app
      initApp();
    </script>
    <hr />
    <h1>Mini Project 6: Country Explorer</h1>

    <div class="explorer-container">
      <h1>üåç Country Explorer</h1>

      <div class="controls">
        <!-- Requirement 4: Search bar -->
        <input
          type="text"
          id="searchBar"
          placeholder="Search for a country..."
        />

        <!-- Requirement 2: Dropdown -->
        <select id="countrySelect">
          <option value="">Select a Country</option>
        </select>
      </div>

      <!-- Requirement 3: Display Area -->
      <div id="countryCard" class="card hidden">
        <img id="flag" src="" alt="Flag" />
        <h2 id="countryName"></h2>
        <p><strong>Capital:</strong> <span id="capital"></span></p>
        <p><strong>Region:</strong> <span id="region"></span></p>
        <p><strong>Population:</strong> <span id="population"></span></p>
      </div>
    </div>
    <script>
      const countrySelect = document.getElementById("countrySelect");
      const searchBar = document.getElementById("searchBar");
      const countryCard = document.getElementById("countryCard");

      let countriesData = [];

      // Requirement 1: Fetch country data
      async function fetchCountries() {
        try {
          const response = await fetch("https://restcountries.com/v3.1/all");
          const data = await response.json();

          // Sort countries alphabetically by name
          countriesData = data.sort((a, b) =>
            a.name.common.localeCompare(b.name.common)
          );

          populateDropdown(countriesData);
        } catch (error) {
          console.error("Error fetching data:", error);
        }
      }

      // Requirement 2: Populate dropdown
      function populateDropdown(list) {
        countrySelect.innerHTML = '<option value="">Select a Country</option>';
        list.forEach((country) => {
          const option = document.createElement("option");
          option.value = country.cca3; // Unique country code
          option.textContent = country.name.common;
          countrySelect.appendChild(option);
        });
      }

      // Requirement 4: Filter countries via search bar
      searchBar.addEventListener("input", (e) => {
        const searchTerm = e.target.value.toLowerCase();
        const filtered = countriesData.filter((c) =>
          c.name.common.toLowerCase().includes(searchTerm)
        );
        populateDropdown(filtered);
      });

      // Requirement 3: Display specific country details
      countrySelect.addEventListener("change", (e) => {
        const selectedCode = e.target.value;
        const country = countriesData.find((c) => c.cca3 === selectedCode);

        if (country) {
          document.getElementById("flag").src = country.flags.svg;
          document.getElementById("countryName").textContent =
            country.name.common;
          document.getElementById("capital").textContent = country.capital
            ? country.capital[0]
            : "N/A";
          document.getElementById("region").textContent = country.region;
          document.getElementById("population").textContent =
            country.population.toLocaleString();

          countryCard.classList.remove("hidden");
        } else {
          countryCard.classList.add("hidden");
        }
      });

      fetchCountries();
    </script>
  </body>
</html>
