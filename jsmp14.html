<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>JS MiniProject Day 14</title>
    <link rel="stylesheet" href="jsmp14.css" />
  </head>
  <body>
    <h1>Mini Project 1 : Typing Speed Tester (Fetch API)</h1>
    <div class="container1">
      <h1>Typing Speed Tester</h1>
      <div id="quote-display" class="quote-display">Loading quote...</div>
      <textarea id="quote-input" class="quote-input" autofocus></textarea>
      <div class="stats">
        <span>WPM: <span id="wpm">0</span></span>
        <span>Time: <span id="timer">0</span>s</span>
      </div>
      <button id="reset-btn">New Sentence</button>
    </div>
    <script>
      const quoteDisplay = document.getElementById("quote-display");
      const quoteInput = document.getElementById("quote-input");
      const wpmDisplay = document.getElementById("wpm");
      const timerDisplay = document.getElementById("timer");
      const resetBtn = document.getElementById("reset-btn");

      let startTime;
      let interval;

      // Fetch random sentence from API
      async function getNextQuote() {
        const response = await fetch("api.quotable.io");
        const data = await response.json();
        quoteDisplay.innerText = data.content;
        quoteInput.value = null;
        resetStats();
      }

      // Logic to track time and speed
      quoteInput.addEventListener("input", () => {
        const arrayQuote = quoteDisplay.querySelectorAll("span"); // Optional: for char highlighting
        const arrayValue = quoteInput.value.split("");

        // Start timer on first character
        if (quoteInput.value.length === 1 && !startTime) {
          startTimer();
        }

        // Check if finished
        if (quoteInput.value === quoteDisplay.innerText) {
          stopTimer();
          calculateWPM();
        }
      });

      function startTimer() {
        startTime = new Date();
        interval = setInterval(() => {
          timerDisplay.innerText = Math.floor((new Date() - startTime) / 1000);
        }, 1000);
      }

      function stopTimer() {
        clearInterval(interval);
      }

      function calculateWPM() {
        const timeInMinutes = (new Date() - startTime) / 60000;
        const wordCount = quoteDisplay.innerText.split(" ").length;
        const wpm = Math.round(wordCount / timeInMinutes);
        wpmDisplay.innerText = wpm;
      }

      function resetStats() {
        stopTimer();
        startTime = null;
        timerDisplay.innerText = 0;
        wpmDisplay.innerText = 0;
      }

      resetBtn.addEventListener("click", getNextQuote);

      // Initial call
      getNextQuote();
    </script>
    <hr />
    <h1>Mini Project 2 : Real-Time Air Quality Checker (Fetch API)</h1>
    <div class="container2">
      <h1>Check Air Quality</h1>
      <div class="location-selector">
        <select id="city-select">
          <option value="40.7128,-74.0060">New York</option>
          <option value="34.0522,-118.2437">Los Angeles</option>
          <option value="51.5074,-0.1278">London</option>
        </select>
        <button onclick="getAQI()">Get AQI</button>
      </div>
      <div class="aqi-result" id="aqi-result">
        <p>AQI: <span id="aqi-value">--</span></p>
        <p>Status: <span id="aqi-status">--</span></p>
        <p>Health Advice: <span id="health-advice">--</span></p>
      </div>
    </div>
    <script>
      const API_KEY = "YOUR_OPENWEATHER_API_KEY"; // Replace with your actual API key
      const citySelect = document.getElementById("city-select");
      const aqiValueEl = document.getElementById("aqi-value");
      const aqiStatusEl = document.getElementById("aqi-status");
      const healthAdviceEl = document.getElementById("health-advice");
      const resultContainer = document.getElementById("aqi-result");

      // Function to fetch air quality data
      async function getAQI() {
        const [lat, lon] = citySelect.value.split(",");
        const url = `api.openweathermap.org{lat}&lon=${lon}&appid=${API_KEY}`;

        try {
          const response = await fetch(url);
          const data = await response.json();

          if (data && data.list && data.list.length > 0) {
            const aqi = data.list[0].main.aqi;
            displayAQI(aqi);
          } else {
            displayError("No data found.");
          }
        } catch (error) {
          console.error("Error fetching AQI:", error);
          displayError("Failed to fetch data. Check API key and console.");
        }
      }

      // Function to display results and add styles based on AQI levels
      function displayAQI(aqi) {
        aqiValueEl.textContent = aqi;
        resultContainer.className = "aqi-result"; // Reset class

        if (aqi >= 1 && aqi <= 50) {
          aqiStatusEl.textContent = "Good";
          healthAdviceEl.textContent =
            "Air quality is considered satisfactory, and air pollution poses little or no risk.";
          resultContainer.classList.add("status-good");
        } else if (aqi >= 51 && aqi <= 100) {
          aqiStatusEl.textContent = "Moderate";
          healthAdviceEl.textContent =
            "Air quality is acceptable; however, some pollutants may pose a moderate health concern for a very small number of people.";
          resultContainer.classList.add("status-moderate");
        } else if (aqi >= 101 && aqi <= 150) {
          aqiStatusEl.textContent = "Unhealthy for Sensitive Groups";
          healthAdviceEl.textContent =
            "Members of sensitive groups may experience health effects. The general public is less likely to be affected.";
          resultContainer.classList.add("status-unhealthy-sensitive");
        } else {
          aqiStatusEl.textContent = "Unhealthy or worse";
          healthAdviceEl.textContent =
            "Health alerts might be triggered. Everyone may begin to experience health effects.";
        }
      }

      function displayError(message) {
        aqiValueEl.textContent = "--";
        aqiStatusEl.textContent = "Error";
        healthAdviceEl.textContent = message;
        resultContainer.className = "aqi-result"; // Reset class
      }

      // Fetch New York AQI on page load
      getAQI();
    </script>
    <hr />
    <h1>MINI PROJECT 3: GitHub User Finder</h1>
    <h1>GitHub User Finder</h1>
    <form id="user-form" aria-label="GitHub user search form">
      <input
        type="text"
        id="username"
        placeholder="Enter GitHub username"
        aria-label="GitHub username"
        required
      />
      <button type="submit" id="search-btn">Search</button>
    </form>

    <div id="result" aria-live="polite" aria-atomic="true">
      <p>Enter a username and click Search.</p>
    </div>

    <script>
      (function () {
        const form = document.getElementById("user-form");
        const usernameInput = document.getElementById("username");
        const resultDiv = document.getElementById("result");
        const searchBtn = document.getElementById("search-btn");

        async function fetchGitHubUser(username) {
          resultDiv.innerHTML = "<p>Loading...</p>";
          searchBtn.disabled = true;
          try {
            const response = await fetch(
              `https://api.github.com/users/${encodeURIComponent(username)}`
            );
            if (response.status === 404) {
              throw new Error("User not found.");
            }
            if (!response.ok) {
              throw new Error("Failed to fetch data.");
            }
            const data = await response.json();
            displayUser(data);
          } catch (error) {
            displayError(error.message);
          } finally {
            searchBtn.disabled = false;
          }
        }

        function displayUser(user) {
          resultDiv.innerHTML = `
          <img id="profile-img" src="${
            user.avatar_url
          }" alt="Profile image of ${user.login}" />
          <p class="info"><strong>Bio:</strong> ${
            user.bio ? user.bio : "No bio available."
          }</p>
          <p class="info"><strong>Public Repos:</strong> ${
            user.public_repos
          }</p>
          <p class="info"><strong>Followers:</strong> ${user.followers}</p>
        `;
        }

        function displayError(message) {
          resultDiv.innerHTML = `<p class="error">${message}</p>`;
        }

        form.addEventListener("submit", (e) => {
          e.preventDefault();
          const username = usernameInput.value.trim();
          if (username) {
            fetchGitHubUser(username);
          }
        });
      })();
    </script>
    <hr />
  </body>
</html>
